{-# LANGUAGE NoImplicitPrelude #-}
{-# LANGUAGE TemplateHaskell #-}
{-# LANGUAGE TypeFamilies #-}
{-# LANGUAGE FlexibleInstances #-}
{-# LANGUAGE MultiParamTypeClasses #-}
{-# OPTIONS_HADDOCK prune #-}

module Data.Aviation.Aip.AipDocuments(
  AipDocuments(..)
, distributeAipDocuments
, writeAipDocuments
, requestAipDocuments
, getAipDocuments
, aipDocuments
) where

import Control.Monad.IO.Class(liftIO)
import Data.ByteString(ByteString)
import Data.Maybe(maybeToList)
import System.Directory(createDirectoryIfMissing)
import System.FilePath((</>))
import System.IO(Handle, IO, IOMode(AppendMode), withFile)
import Control.Monad.Trans.Except(ExceptT, runExceptT)
import Data.Aviation.Aip.AipDate(uriAipDate)
import Data.Aviation.Aip.AipDocument(AipDocument(AipDocument), requestAipDocument)
import Data.Aviation.Aip.AipHref(aiphrefdate)
import Data.Aviation.Aip.ConnErrorHttp4xx(ConnErrorHttp4xx)
import Data.Aviation.Aip.Ersa(ersaHref, ersaDate)
import Data.Aviation.Aip.Ersas(Ersas(Ersas), parseAipTree)
import Data.Aviation.Aip.HttpRequest(requestAipContents, aipRequestGet)
import Network.BufferType(BufferType)
import Papa

newtype AipDocuments ty =
  AipDocuments
    [AipDocument ty]
  deriving Show

makeWrapped ''AipDocuments

-- | Writes three log files; `err.log`, `out.log`, `aip`.
distributeAipDocuments ::
  FilePath -- ^ log error
  -> FilePath -- ^ log out
  -> IO [FilePath]
distributeAipDocuments adir ldir=
  let wlogfile f =
        liftIO . withFile (ldir </> f) AppendMode
  in  do  liftIO (mapM_ (createDirectoryIfMissing True) [adir, ldir])
          wlogfile "err.log" (\herr ->
            wlogfile "out.log" (\hout ->
              do  p <- runExceptT (writeAipDocuments herr hout adir)
                  mapM_ (\qs -> appendFile (ldir </> "aip") (qs >>= \q -> q ++ "\n")) p
                  pure (either (const []) id p)))

writeAipDocuments ::
    Handle -- ^ log error
  -> Handle -- ^ log out
  -> FilePath
  -> ExceptT ConnErrorHttp4xx IO [FilePath]
writeAipDocuments errlog outlog dir =
  requestAipContents >>= liftIO . requestAipDocuments errlog outlog . getAipDocuments dir . parseAipTree

requestAipDocuments ::
  Handle -- ^ log error
  -> Handle -- ^ log out
  -> AipDocuments ByteString
  -> IO [FilePath]
requestAipDocuments errlog outlog (AipDocuments ds) =
  (>>= maybeToList) <$> mapM (requestAipDocument errlog outlog) ds

getAipDocuments ::
  BufferType ty =>
  FilePath -- output directory 
  -> Ersas
  -> AipDocuments ty
getAipDocuments dir es =
  AipDocuments ((\r -> AipDocument (aipRequestGet r "") (dir </> r)) <$> aipDocuments es)

aipDocuments ::
  Ersas
  -> [String]
aipDocuments (Ersas ersas) =
  let prelim =
        [
          "GUID_ersa-fac-1-3"
        , "GUID_ersa-fac-1-4"
        , "GUID_ersa-fac-1-5"
        , "PRD_"
        , "LND_"
        , "IFR_"
        , "VFR_"
        , "GUID_ersa-fac-2-2"
        , "GUID_ersa-fac-2-3"
        , "GUID_ersa-fac-2-4"
        , "GUID_ersa-fac-2-5"
        , "GUID_ersa-fac-2-6"
        , "GUID_ersa-fac-2-7"
        , "GUID_ersa-fac-2-8"
        , "GUID_ersa-fac-2-9"
        , "GUID_ersa-fac-2-10"
        , "GUID_ersa-fac-2-11"
        , "GUID_ersa-fac-2-12"
        , "GUID_ersa-fac-2-14"
        ]
      books =
        [
          --  AIP Book
          "aip/complete"
        , "aip/general"
        , "aip/enroute"
        , "aip/aerodrome"
        , "aip/cover"
        , "aip/index"
        ]
      charts =
        [
          --  AIP Charts (current)
          "aipchart/erch/erch1"
        , "aipchart/erch/erch2"
        , "aipchart/erch/erch3"
        , "aipchart/erch/erch4"
        , "aipchart/erch/erch5"
        , "aipchart/ercl/ercl1"
        , "aipchart/ercl/ercl2"
        , "aipchart/ercl/ercl3"
        , "aipchart/ercl/ercl4"
        , "aipchart/ercl/ercl5"
        , "aipchart/ercl/ercl6"
        , "aipchart/ercl/ercl7"
        , "aipchart/ercl/ercl8"
        , "aipchart/pca/PCA_back"
        , "aipchart/pca/PCA_front"
        , "aipchart/tac/tac1"
        , "aipchart/tac/tac2"
        , "aipchart/tac/tac3"
        , "aipchart/tac/tac4"
        , "aipchart/tac/tac5"
        , "aipchart/tac/tac6"
        , "aipchart/tac/tac7"
        , "aipchart/tac/tac8"
        , "aipchart/vnc/Adelaide_VNC"
        , "aipchart/vnc/Brisbane_VNC"
        , "aipchart/vnc/Bundaberg_VNC"
        , "aipchart/vnc/Cairns_VNC"
        , "aipchart/vnc/Darwin_VNC"
        , "aipchart/vnc/Deniliquin_VNC"
        , "aipchart/vnc/Hobart_VNC"
        , "aipchart/vnc/Launceston_VNC"
        , "aipchart/vnc/Melbourne_VNC"
        , "aipchart/vnc/Newcastle_VNC"
        , "aipchart/vnc/Perth_VNC"
        , "aipchart/vnc/Rockhampton_VNC"
        , "aipchart/vnc/Sydney_VNC"
        , "aipchart/vnc/Tindal_VNC"
        , "aipchart/vnc/Townsville_VNC"
        , "aipchart/vtc/Adelaide_VTC"
        , "aipchart/vtc/Albury_VTC"
        , "aipchart/vtc/AliceSprings_Uluru_VTC"
        , "aipchart/vtc/Brisbane_Sunshine_VTC"
        , "aipchart/vtc/Broome_VTC"
        , "aipchart/vtc/Cairns_VTC"
        , "aipchart/vtc/Canberra_VTC"
        , "aipchart/vtc/Coffs_Harbour_VTC"
        , "aipchart/vtc/Darwin_VTC"
        , "aipchart/vtc/Gold_Coast_VTC"
        , "aipchart/vtc/Hobart_VTC"
        , "aipchart/vtc/Karratha_VTC"
        , "aipchart/vtc/Launceston_VTC"
        , "aipchart/vtc/Mackay_VTC"
        , "aipchart/vtc/Melbourne_VTC"
        , "aipchart/vtc/Newcastle_Williamtown_VTC"
        , "aipchart/vtc/Oakey_Bris_VTC"
        , "aipchart/vtc/perth_legend"
        , "aipchart/vtc/Perth_VTC"
        , "aipchart/vtc/Rockhampton_VTC"
        , "aipchart/vtc/Sydney_VTC"
        , "aipchart/vtc/Tamworth_VTC"
        , "aipchart/vtc/Townsville_VTC"
        , "aipchart/vtc/Whitsunday_VTC"
        ]
      dap =
        [
          -- DAP
          "dap/SpecNotManTOC.htm"
        , "dap/ChecklistTOC.htm"
        , "dap/LegendInfoTablesTOC.htm"
        , "dap/AeroProcChartsTOC.htm"
        ]
      dah =
        [
          -- DAH
          "dah/dah.pdf"
        ]
      precisionApproachCharts =
        [
          -- Precision Approach Terrain Charts and Type A & Type B Obstacle Charts
          "chart/TypeAandBCharts.pdf"
        ]
      fac =
        ("FAC_" ++) <$> 
        [
          "YADY"
        , "ADAC"
        , "YPAD"
        , "YPPF"
        , "YALG"
        , "YABA"
        , "YMAY"
        , "YADG"
        , "YBAS"
        , "YAPH"
        , "YAMT"
        , "YAMB"
        , "YANK"
        , "YAMC"
        , "YARA"
        , "YARG"
        , "YARK"
        , "YARM"
        , "YARY"
        , "YATN"
        , "YAUG"
        , "YAGD"
        , "YAUR"
        , "YMAV"
        , "YAYE"
        , "YAYR"
        , "YBSS"
        , "YBAU"
        , "YBNS"
        , "YBLC"
        , "YBGO"
        , "YBLT"
        , "YLLE"
        , "YBIU"
        , "YBNA"
        , "YBRN"
        , "YBMY"
        , "YBAD"
        , "YBAB"
        , "YBAR"
        , "YBRY"
        , "YBWX"
        , "YBRS"
        , "YBYL"
        , "YBTH"
        , "YBTI"
        , "YBPK"
        , "YBFT"
        , "YBIE"
        , "YBEB"
        , "YBLU"
        , "YBLA"
        , "YBDG"
        , "YBEO"
        , "YBEE"
        , "YBHL"
        , "YBIR"
        , "YBDV"
        , "YBCK"
        , "YBTR"
        , "YBLP"
        , "YBOI"
        , "YBLL"
        , "YBOM"
        , "YBOC"
        , "YBGD"
        , "YBMI"
        , "YBOA"
        , "YBBT"
        , "YBOR"
        , "YBRL"
        , "YBOU"
        , "YBKE"
        , "YBWN"
        , "YBPI"
        , "YBRW"
        , "YBGR"
        , "BNAC"
        , "YBWW"
        , "YBBN"
        , "YBAF"
        , "YBHI"
        , "BML"
        , "YBRM"
        , "YBNR"
        , "YBUN"
        , "YBUD"
        , "YBKT"
        , "YBLN"
        , "YCAB"
        , "YCDH"
        , "YCAG"
        , "YBCS"
        , "YCDR"
        , "YCVG"
        , "YSCN"
        , "YCMH"
        , "YCMW"
        , "YSCB"
        , "YCLQ"
        , "YCPR"
        , "YCEL"
        , "YCAV"
        , "YCDW"
        , "YCAR"
        , "YCAS"
        , "YCTN"
        , "YCDU"
        , "YCNY"
        , "YCES"
        , "YCNK"
        , "YBCV"
        , "YCHT"
        , "YCGO"
        , "YCCA"
        , "YCHK"
        , "YPXM"
        , "YCVA"
        , "YCMT"
        , "YCEE"
        , "YCFN"
        , "YCCY"
        , "YUNY"
        , "YCBA"
        , "YCDE"
        , "YCCT"
        , "YPCC"
        , "YCOE"
        , "YCFS"
        , "YCOH"
        , "YOLA"
        , "YCEM"
        , "YCBR"
        , "YCSV"
        , "YCDO"
        , "YCBP"
        , "YCOO"
        , "YCKN"
        , "YCAH"
        , "YCXA"
        , "YPFT"
        , "YCOM"
        , "YBCM"
        , "YCBB"
        , "YCNM"
        , "YCWA"
        , "YCTM"
        , "YCOR"
        , "YCRG"
        , "YCWL"
        , "YCWR"
        , "YCRN"
        , "YCKI"
        , "YCRL"
        , "YCRY"
        , "YCUE"
        , "YCMM"
        , "YCUN"
        , "YCMU"
        , "YCIN"
        , "YDAY"
        , "YDLO"
        , "YDNI"
        , "DNAC"
        , "YPDN"
        , "YDPD"
        , "YDGU"
        , "YDWF"
        , "YDLV"
        , "YDLT"
        , "YDLQ"
        , "YDEK"
        , "YDBY"
        , "YDPO"
        , "YDBI"
        , "YDOC"
        , "YDVR"
        , "YDOD"
        , "YDOP"
        , "YDMG"
        , "YDOR"
        , "YDRN"
        , "YDRD"
        , "YSDU"
        , "YDKG"
        , "YDBR"
        , "YDKI"
        , "YDUN"
        , "YDRH"
        , "YDRI"
        , "YDYS"
        , "YEJI"
        , "YMES"
        , "YECH"
        , "YECB"
        , "YPED"
        , "YESD"
        , "YELD"
        , "YEQY"
        , "YELN"
        , "YESE"
        , "YEML"
        , "YMKT"
        , "YEMP"
        , "YENO"
        , "YEHP"
        , "YERN"
        , "YEMG"
        , "YESP"
        , "YEUO"
        , "YEUA"
        , "YEVD"
        , "YEXM"
        , "YFDN"
        , "YFTZ"
        , "YFLI"
        , "YFBS"
        , "YFRT"
        , "YFTA"
        , "YFDF"
        , "YFRG"
        , "YGAD"
        , "YGPT"
        , "YGAS"
        , "YGAW"
        , "YGAY"
        , "YGTO"
        , "YGTN"
        , "YGEL"
        , "YGIB"
        , "YGLS"
        , "YGIL"
        , "YGIA"
        , "YGIG"
        , "YGLA"
        , "YGLI"
        , "YGHP"
        , "YGNB"
        , "YGLO"
        , "YGNW"
        , "YBCG"
        , "YGGE"
        , "YGDA"
        , "YGGI"
        , "YGWA"
        , "YGDI"
        , "YGLB"
        , "YPGV"
        , "YGFN"
        , "YGRS"
        , "YGRL"
        , "YGDS"
        , "YGTH"
        , "YGTE"
        , "YGRM"
        , "YGDO"
        , "YGDH"
        , "YGYM"
        , "YHAA"
        , "YHLC"
        , "YHML"
        , "YBHM"
        , "YHAE"
        , "YHAW"
        , "YHAY"
        , "YHEC"
        , "YHCS"
        , "YHMB"
        , "YHBA"
        , "YHLS"
        , "YMHB"
        , "YCBG"
        , "YHBK"
        , "YSHW"
        , "YHON"
        , "YHOO"
        , "YHPN"
        , "YHID"
        , "YHSM"
        , "YHUG"
        , "YHRD"
        , "YIFY"
        , "YILF"
        , "YIGM"
        , "YINJ"
        , "YIKM"
        , "YINN"
        , "YIMT"
        , "YIFL"
        , "YIVL"
        , "YISF"
        , "YIVO"
        , "YJAB"
        , "YJAC"
        , "YJST"
        , "YJER"
        , "YJBY"
        , "YJIN"
        , "YJLC"
        , "YJDA"
        , "YJUN"
        , "YJNB"
        , "YKDI"
        , "YKBR"
        , "YPKG"
        , "YKKG"
        , "YKAL"
        , "YKBL"
        , "YKML"
        , "YKAR"
        , "YPKA"
        , "YKMB"
        , "YKNG"
        , "YKAT"
        , "YKMP"
        , "YKER"
        , "YKHO"
        , "YKDM"
        , "YKID"
        , "YKCY"
        , "YKLE"
        , "YIMB"
        , "YKKN"
        , "YKAB"
        , "YKII"
        , "YKRY"
        , "YKCS"
        , "YKSC"
        , "YKIG"
        , "YKBN"
        , "YKOW"
        , "YKUB"
        , "YPKU"
        , "YKTN"
        , "YLCG"
        , "YLEV"
        , "YLJN"
        , "YKEP"
        , "YLMQ"
        , "YLND"
        , "YLKE"
        , "YLAK"
        , "YLCK"
        , "YLTV"
        , "YMLT"
        , "YLTN"
        , "YLAW"
        , "YLAH"
        , "YPLM"
        , "YLGU"
        , "YLEC"
        , "YLST"
        , "YLEG"
        , "YLEO"
        , "YLED"
        , "YLRD"
        , "YLIL"
        , "YLIS"
        , "YLZI"
        , "YLHR"
        , "YLCS"
        , "YUOF"
        , "YLRE"
        , "YLHI"
        , "YLOR"
        , "YLOH"
        , "YLOX"
        , "YLYK"
        , "YMAA"
        , "YBMK"
        , "YMND"
        , "YMLD"
        , "YMCO"
        , "YMNG"
        , "YMGD"
        , "YMJM"
        , "YMFD"
        , "YMBL"
        , "YMBA"
        , "YMGT"
        , "YMGR"
        , "YALA"
        , "YMRE"
        , "YMYB"
        , "YMBU"
        , "YMHU"
        , "YMEK"
        , "MLAC"
        , "YMML"
        , "YMEN"
        , "YMMB"
        , "YMEL"
        , "YMET"
        , "YMEI"
        , "YMER"
        , "YMDN"
        , "YMMU"
        , "YMIA"
        , "YMLS"
        , "YMGB"
        , "YMIO"
        , "YMCT"
        , "YMMN"
        , "YMDR"
        , "YMPA"
        , "YMIB"
        , "YMIT"
        , "YITT"
        , "YMIG"
        , "YMMO"
        , "YMOD"
        , "YMNK"
        , "YMTO"
        , "YOOM"
        , "YMOO"
        , "YMRB"
        , "YMRW"
        , "YMOR"
        , "YMNY"
        , "YMTI"
        , "YMRY"
        , "YMBT"
        , "YMDY"
        , "YMCL"
        , "YMTG"
        , "YGON"
        , "YMHL"
        , "YHOT"
        , "YMHO"
        , "YMHW"
        , "YBMA"
        , "YMNE"
        , "YMOG"
        , "YMSF"
        , "YMOU"
        , "YMDG"
        , "YMWA"
        , "YMDA"
        , "YMGI"
        , "YLMU"
        , "YMRG"
        , "YMBD"
        , "YMUL"
        , "YMAE"
        , "YMMI"
        , "YMUR"
        , "YMTB"
        , "YMYU"
        , "YNKR"
        , "YNGW"
        , "YNAP"
        , "YNRC"
        , "YNRB"
        , "YNBR"
        , "YNAR"
        , "YNRG"
        , "YNRM"
        , "YNEY"
        , "YNRH"
        , "YNWN"
        , "YNGU"
        , "YNHL"
        , "YCNF"
        , "YNSH"
        , "YSNF"
        , "YNTN"
        , "YNSM"
        , "YNTM"
        , "YNPE"
        , "YNOV"
        , "YSNW"
        , "YNUL"
        , "YNUB"
        , "YNUM"
        , "YNYN"
        , "YBOK"
        , "YOAY"
        , "YOCA"
        , "YOEN"
        , "YOLD"
        , "YOLW"
        , "YOOD"
        , "YORG"
        , "YOEH"
        , "YORB"
        , "YORR"
        , "YOSB"
        , "YPAC"
        , "YPAM"
        , "YPAY"
        , "YPBO"
        , "YPKS"
        , "YPEA"
        , "YPEF"
        , "PHAC"
        , "YPPH"
        , "YPJT"
        , "YPTB"
        , "YPBH"
        , "YPID"
        , "YPNA"
        , "YPNN"
        , "YPWH"
        , "YPLU"
        , "YMPC"
        , "YPCE"
        , "YPOK"
        , "YPMP"
        , "YPAG"
        , "POCA"
        , "YPHP"
        , "YPPD"
        , "YPKT"
        , "YPLC"
        , "YPMQ"
        , "YPIR"
        , "YPOD"
        , "YPMH"
        , "YBPN"
        , "YPKL"
        , "YPUG"
        , "YQNS"
        , "YQLP"
        , "YQDI"
        , "YQRN"
        , "YRNG"
        , "YNRV"
        , "YRYP"
        , "YRED"
        , "YREN"
        , "YSRI"
        , "YRMD"
        , "YRID"
        , "YRBE"
        , "YRBK"
        , "YROB"
        , "YROI"
        , "YRCD"
        , "YBRK"
        , "YRLL"
        , "YROM"
        , "YRSY"
        , "YRAY"
        , "YRSB"
        , "YRSH"
        , "YRTI"
        , "YRNS"
        , "YRPA"
        , "YRTP"
        , "YRYL"
        , "YSII"
        , "YSTA"
        , "YSGE"
        , "YSTH"
        , "YSAM"
        , "YBSG"
        , "YSCO"
        , "YSCA"
        , "YSLK"
        , "YSEN"
        , "YSHK"
        , "YSHG"
        , "YSHT"
        , "YSHR"
        , "YSGT"
        , "YSMI"
        , "YSNB"
        , "YSOL"
        , "YSMB"
        , "YSGW"
        , "YGBI"
        , "YSGR"
        , "YSCR"
        , "YSPT"
        , "YSPK"
        , "YSPI"
        , "YSPE"
        , "YSWL"
        , "YSFG"
        , "YSTO"
        , "YSRN"
        , "YKBY"
        , "YSNY"
        , "YSRD"
        , "YBSU"
        , "YSRT"
        , "YSWB"
        , "YSWH"
        , "YSSY"
        , "YSBK"
        , "YTMB"
        , "YSTW"
        , "YTMN"
        , "YTAA"
        , "YTRE"
        , "YTAM"
        , "YTEF"
        , "YTEM"
        , "YTNK"
        , "YTNG"
        , "YTGM"
        , "YTGT"
        , "YLKS"
        , "YTMO"
        , "YOAS"
        , "YVAL"
        , "YTDR"
        , "YTHN"
        , "YTHY"
        , "YTIB"
        , "YTLP"
        , "YTBR"
        , "YPTN"
        , "YTOC"
        , "YTDN"
        , "YTKS"
        , "YTWN"
        , "YTWB"
        , "YTQY"
        , "YTOT"
        , "YBTL"
        , "YTWG"
        , "YTEE"
        , "YTRA"
        , "YTTI"
        , "YTFA"
        , "YTST"
        , "YTUY"
        , "YTBB"
        , "YTMU"
        , "YTPK"
        , "YTYA"
        , "YTYH"
        , "YUDA"
        , "YUDG"
        , "YVRS"
        , "YVRD"
        , "YSWG"
        , "YWGN"
        , "YWHG"
        , "YWKI"
        , "YWCH"
        , "YWLG"
        , "YWAG"
        , "YWGT"
        , "YWBR"
        , "YWRL"
        , "YWKW"
        , "YWVA"
        , "YWBS"
        , "YWBI"
        , "YWKB"
        , "YWRN"
        , "YWBL"
        , "YWCK"
        , "YWTL"
        , "YWTB"
        , "YWSG"
        , "YWAV"
        , "YWBN"
        , "YBWP"
        , "YWEL"
        , "YWTO"
        , "YANG"
        , "WMD_"
        , "YWSL"
        , "YWWL"
        , "YWST"
        , "YWHC"
        , "YWHA"
        , "YWCA"
        , "YWMC"
        , "YWIS"
        , "YWLM"
        , "YWLU"
        , "YWDG"
        , "YWDH"
        , "YWTN"
        , "YWVR"
        , "YWOL"
        , "YWHP"
        , "YWND"
        , "YWDL"
        , "YWWI"
        , "YPWR"
        , "YWMP"
        , "YWUD"
        , "YWYA"
        , "YWYF"
        , "YWYM"
        , "YWYY"
        , "YWYR"
        , "YYMI"
        , "YYRN"
        , "YYRM"
        , "YYWG"
        , "YYKI"
        , "YYNG"
        , "YYND"
        ]
      rds =
        ("RDS_" ++) <$> 
        [
          "YPAD"
        , "YPPF"
        , "YABA"
        , "YMAY"
        , "YBAS"
        , "YAPH"
        , "YAMB"
        , "YARA"
        , "YARG"
        , "YARM"
        , "YAUR"
        , "YMAV"
        , "YAYE"
        , "YBNS"
        , "YBGO"
        , "YBLT"
        , "YLLE"
        , "YBNA"
        , "YBRN"
        , "YBAR"
        , "YBRY"
        , "YBWX"
        , "YBTH"
        , "YBTI"
        , "YBIE"
        , "YBLU"
        , "YBLA"
        , "YBDG"
        , "YBIR"
        , "YBDV"
        , "YBCK"
        , "YBGD"
        , "YBOU"
        , "YBKE"
        , "YBWN"
        , "YBRW"
        , "YBWW"
        , "YBBN"
        , "YBAF"
        , "YBHI"
        , "YBRM"
        , "YBUN"
        , "YBUD"
        , "YBKT"
        , "YBLN"
        , "YBCS"
        , "YSCN"
        , "YCMW"
        , "YSCB"
        , "YCPR"
        , "YCAR"
        , "YCDU"
        , "YCNY"
        , "YCNK"
        , "YBCV"
        , "YCHT"
        , "YCGO"
        , "YCCA"
        , "YCHK"
        , "YPXM"
        , "YCMT"
        , "YCEE"
        , "YCCY"
        , "YCBA"
        , "YPCC"
        , "YCOE"
        , "YCFS"
        , "YCDO"
        , "YCBP"
        , "YCKN"
        , "YCAH"
        , "YCOM"
        , "YCBB"
        , "YCNM"
        , "YCWA"
        , "YCTM"
        , "YCOR"
        , "YCRG"
        , "YCWR"
        , "YCKI"
        , "YCUN"
        , "YCMU"
        , "YCIN"
        , "YDLO"
        , "YPDN"
        , "YDGU"
        , "YDLQ"
        , "YDBY"
        , "YDPO"
        , "YDBI"
        , "YDOD"
        , "YDMG"
        , "YSDU"
        , "YDKG"
        , "YEJI"
        , "YMES"
        , "YECH"
        , "YPED"
        , "YELD"
        , "YEML"
        , "YESP"
        , "YFTZ"
        , "YFLI"
        , "YFBS"
        , "YFRT"
        , "YFTA"
        , "YFDF"
        , "YGPT"
        , "YGAY"
        , "YGTN"
        , "YGEL"
        , "YGIA"
        , "YGIG"
        , "YGLA"
        , "YGLI"
        , "YBCG"
        , "YGGE"
        , "YGDA"
        , "YGDI"
        , "YGLB"
        , "YPGV"
        , "YGFN"
        , "YGRS"
        , "YGTH"
        , "YGTE"
        , "YGRM"
        , "YGDH"
        , "YHLC"
        , "YHML"
        , "YBHM"
        , "YHAY"
        , "YHBA"
        , "YMHB"
        , "YHPN"
        , "YHID"
        , "YHSM"
        , "YHUG"
        , "YIFL"
        , "YIVL"
        , "YJAB"
        , "YJAC"
        , "YJLC"
        , "YJUN"
        , "YKBR"
        , "YPKG"
        , "YKKG"
        , "YKAL"
        , "YKAR"
        , "YPKA"
        , "YKMB"
        , "YKNG"
        , "YKMP"
        , "YKER"
        , "YIMB"
        , "YKII"
        , "YKRY"
        , "YKSC"
        , "YKOW"
        , "YPKU"
        , "YLCG"
        , "YLEV"
        , "YLTV"
        , "YMLT"
        , "YLTN"
        , "YPLM"
        , "YLEC"
        , "YLST"
        , "YLEO"
        , "YLRD"
        , "YLIS"
        , "YLHR"
        , "YLRE"
        , "YLHI"
        , "YLOX"
        , "YBMK"
        , "YMND"
        , "YMCO"
        , "YMNG"
        , "YMGD"
        , "YMJM"
        , "YMBA"
        , "YMYB"
        , "YMBU"
        , "YMHU"
        , "YMEK"
        , "YMML"
        , "YMEN"
        , "YMMB"
        , "YMER"
        , "YMMU"
        , "YMIA"
        , "YMLS"
        , "YMGB"
        , "YOOM"
        , "YMRB"
        , "YMRW"
        , "YMOR"
        , "YMTI"
        , "YMRY"
        , "YMTG"
        , "YGON"
        , "YHOT"
        , "YBMA"
        , "YMNE"
        , "YMOG"
        , "YMDG"
        , "YMUL"
        , "YMMI"
        , "YNRC"
        , "YNBR"
        , "YNAR"
        , "YNRM"
        , "YNWN"
        , "YNGU"
        , "YNHL"
        , "YCNF"
        , "YSNF"
        , "YNTN"
        , "YNSM"
        , "YNPE"
        , "YNOV"
        , "YSNW"
        , "YNUM"
        , "YNYN"
        , "YBOK"
        , "YOEN"
        , "YOLD"
        , "YOLW"
        , "YORG"
        , "YORB"
        , "YOSB"
        , "YPAM"
        , "YPBO"
        , "YPKS"
        , "YPEA"
        , "YPPH"
        , "YPJT"
        , "YPLU"
        , "YMPC"
        , "YPCE"
        , "YPMP"
        , "YPAG"
        , "YPPD"
        , "YPKT"
        , "YPLC"
        , "YPMQ"
        , "YPIR"
        , "YPOD"
        , "YPMH"
        , "YBPN"
        , "YQLP"
        , "YQDI"
        , "YRNG"
        , "YNRV"
        , "YREN"
        , "YSRI"
        , "YRMD"
        , "YROI"
        , "YBRK"
        , "YROM"
        , "YRTI"
        , "YSII"
        , "YSTA"
        , "YSGE"
        , "YSTH"
        , "YBSG"
        , "YSCO"
        , "YSLK"
        , "YSHK"
        , "YSHT"
        , "YSNB"
        , "YSOL"
        , "YGBI"
        , "YSCR"
        , "YSPT"
        , "YSPE"
        , "YSWL"
        , "YSRN"
        , "YKBY"
        , "YSRD"
        , "YBSU"
        , "YSWH"
        , "YSSY"
        , "YSBK"
        , "YSTW"
        , "YTRE"
        , "YTAM"
        , "YTEF"
        , "YTEM"
        , "YTNK"
        , "YTNG"
        , "YTGM"
        , "YTGT"
        , "YTMO"
        , "YTHN"
        , "YTIB"
        , "YPTN"
        , "YTOC"
        , "YTWB"
        , "YBTL"
        , "YTEE"
        , "YTRA"
        , "YTTI"
        , "YTST"
        , "YTBB"
        , "YTMU"
        , "YSWG"
        , "YWKI"
        , "YWLG"
        , "YWGT"
        , "YWBR"
        , "YWKB"
        , "YWRN"
        , "YWBL"
        , "YWCK"
        , "YBWP"
        , "YWTO"
        , "YANG"
        , "YWSL"
        , "YWWL"
        , "YWHA"
        , "YWLM"
        , "YWLU"
        , "YWDH"
        , "YWTN"
        , "YWOL"
        , "YWWI"
        , "YPWR"
        , "YWUD"
        , "YWYF"
        , "YWYM"
        , "YWYY"
        , "YYRN"
        , "YYRM"
        , "YYWG"
        , "YYKI"
        , "YYNG"
        ]
      req x k =
        x >>= \f ->
        ["current/", "pending/"] >>= \q ->
        ersas >>= \er ->
        [er ^. ersaDate, er ^. ersaHref . aiphrefdate] >>= \d ->
        ["", '_' : uriAipDate d] >>= \s ->
        pure (k f q s)
  in  nub . concat $
        [
          req prelim                  (\f q s -> q ++ "ersa/" ++ f ++ s ++ ".pdf")
        , req fac                     (\f q s -> q ++ "ersa/" ++ f ++ s ++ ".pdf")
        , req rds                     (\f q s -> q ++ "ersa/" ++ f ++ s ++ ".pdf")
        , req charts                  (\f q s -> q ++ f ++ s ++ ".pdf")
        , req books                   (\f q s -> q ++ f ++ s ++ ".pdf")
        , req dap                     (\f q _ -> q ++ f)
        , req dah                     (\f q _ -> q ++ f)
        , req precisionApproachCharts (\f q _ -> q ++ f)
        ]
